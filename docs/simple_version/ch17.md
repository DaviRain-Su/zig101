# Zig 向量和 SIMD

## SIMD 概述
**SIMD（单指令流多数据流）**：让单个指令同时操作多个数据，实现并行计算，提升性能。

现代CPU大多支持SIMD操作，广泛用于视频/音频处理和图形应用。

## 向量基础

### 创建向量
使用 `@Vector(长度, 类型)` 创建向量对象：

```zig
const v1 = @Vector(4, u32){4, 12, 37, 9};
const v2 = @Vector(4, u32){10, 22, 5, 12};
const v3 = v1 + v2;  // 并行执行4个加法
// 结果: { 14, 34, 42, 21 }
```

### 支持的操作
向量上的这些操作会自动使用SIMD并行执行：
- **算术运算**：`+`, `-`, `/`, `*`, `@divFloor()`, `@sqrt()` 等
- **位运算**：`>>`, `<<`, `&`, `|`, `~` 等
- **比较运算**：`<`, `>`, `==` 等

所有运算默认按元素（element-wise）并行执行。

## 数组与向量转换

### 隐式转换
```zig
const a1 = [4]u32{4, 12, 37, 9};
const v1: @Vector(4, u32) = a1;  // 直接赋值
```

### 切片转换
```zig
const a1 = [4]u32{4, 12, 37, 9};
const v2: @Vector(2, u32) = a1[1..3].*;  // 切片转向量
```

⚠️ **限制**：只能转换编译时已知大小的数组和切片。

## @splat() 函数
用相同值填充向量的所有元素：

```zig
const v1: @Vector(10, u32) = @splat(16);
// 结果: { 16, 16, 16, 16, 16, 16, 16, 16, 16, 16 }
```

## 注意事项

### 向量大小限制
向量通常是 128/256/512 位的小块。创建过大的向量会导致编译错误：

```zig
// ❌ 错误示例 - 向量太大
const v1: @Vector(1000000, u32) = @splat(16);
// 导致: Segmentation fault
```

### 最佳实践
- 向量只支持原始数据类型
- 保持向量大小适中（通常 2-16 个元素）
- 确保CPU支持SIMD（不支持时退化为普通循环）

## 性能优势示例

```zig
// 传统方式 - 顺序执行
for (a1, 0..) |val, i| {
    result[i] = val + b1[i];
}

// SIMD方式 - 并行执行
const v1 = @Vector(4, u32){...};
const v2 = @Vector(4, u32){...};
const result = v1 + v2;  // 4个加法同时执行
```

SIMD将多个操作合并为单条指令，显著提升计算密集型任务的性能。
